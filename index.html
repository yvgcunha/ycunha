<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finan√ßas Pro 2026 - Master Edition</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700;800&display=swap');

        :root {
            --bg: #f5f5f7; --surface: #ffffff; --surface2: #fafafa; --border: rgba(0,0,0,0.07);
            --text: #1d1d1f; --text2: #6e6e73; --text3: #aeaeb2; --blue: #0071e3; --green: #28cd41;
            --red: #ff3b30; --orange: #ff9f0a; --purple: #bf5af2; --shadow: 0 4px 20px rgba(0,0,0,0.08);
            --r: 16px;
        }

        [data-theme="dark"] {
            --bg: #000000; --surface: #1c1c1e; --surface2: #2c2c2e; --border: rgba(255,255,255,0.1);
            --text: #f5f5f7; --text2: #a1a1a6; --text3: #636366;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'DM Sans', sans-serif; }
        body { background: var(--bg); color: var(--text); transition: background 0.3s; height: 100vh; overflow: hidden; }

        .layout { display: flex; height: 100vh; }
        
        /* Sidebar */
        .sidebar { width: 260px; background: var(--surface); border-right: 1px solid var(--border); padding: 24px; display: flex; flex-direction: column; gap: 4px; overflow-y: auto; }
        .logo-btn { padding: 10px 12px; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; cursor: pointer; border-radius: 12px; transition: 0.2s; }
        .logo-btn:hover { background: var(--bg); }

        /* Accordion Menu */
        .nav-section { 
            font-size: 10px; font-weight: 800; color: var(--text3); text-transform: uppercase; 
            margin: 18px 0 6px 10px; letter-spacing: 1px; display: flex; justify-content: space-between; 
            align-items: center; cursor: pointer; user-select: none;
        }
        .nav-section::after { content: '‚ñæ'; font-size: 12px; transition: transform 0.3s; }
        .nav-section.collapsed::after { transform: rotate(-90deg); }
        .nav-group { overflow: hidden; transition: max-height 0.3s ease-out; max-height: 500px; }
        .nav-group.collapsed { max-height: 0; }

        .nav-item { padding: 10px 12px; border-radius: 10px; cursor: pointer; font-size: 14px; font-weight: 600; color: var(--text2); transition: 0.2s; display: flex; align-items: center; gap: 10px; }
        .nav-item:hover { background: var(--bg); color: var(--text); }
        .nav-item.active { background: var(--blue); color: white !important; }

        /* Content Area */
        .main-container { flex: 1; display: flex; flex-direction: column; height: 100vh; }
        .topbar { background: var(--surface); padding: 15px 30px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; z-index: 80; }
        .content-area { flex: 1; overflow-y: auto; padding: 30px; }
        
        .card { background: var(--surface); padding: 20px; border-radius: var(--r); border: 1px solid var(--border); box-shadow: var(--shadow); margin-bottom: 20px; }
        
        /* Form & Buttons */
        .form-control { width: 100%; padding: 12px; border-radius: 10px; border: 1.5px solid var(--border); background: var(--bg); color: var(--text); outline: none; margin-bottom: 10px; }
        .btn { padding: 10px 18px; border-radius: 10px; border: none; cursor: pointer; font-weight: 700; font-size: 13px; transition: 0.2s; display: inline-flex; align-items: center; gap: 8px; }
        .btn-primary { background: var(--blue); color: white; }
        .btn-ghost { background: transparent; border: 1px solid var(--border); color: var(--text); }

        .tag { padding: 4px 8px; border-radius: 6px; font-size: 10px; font-weight: 800; text-transform: uppercase; }
        .tag-receita { background: #e6f9ea; color: var(--green); }
        .tag-despesa { background: #fff0ef; color: var(--red); }

        #loginOverlay { position: fixed; inset: 0; background: var(--bg); z-index: 1000; display: flex; align-items: center; justify-content: center; flex-direction: column; gap: 20px; }
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.4); backdrop-filter: blur(6px); display: none; align-items: center; justify-content: center; z-index: 200; }
        .modal-content { background: var(--surface); padding: 32px; border-radius: var(--r); width: 100%; max-width: 520px; }
    </style>
</head>
<body data-theme="light">

<div id="loginOverlay">
    <div style="text-align: center; background: var(--surface); padding: 40px; border-radius: 20px; box-shadow: var(--shadow);">
        <h2>üîê Acesso Finan√ßas</h2>
        <input type="password" id="passInput" class="form-control" style="width: 240px; text-align: center; margin-top: 20px;" placeholder="Senha">
        <button class="btn btn-primary" onclick="handleManualLogin()" style="width: 240px; margin-top: 15px;">Entrar</button>
    </div>
</div>

<div class="layout" id="mainLayout" style="display:none;">
    <aside class="sidebar">
        <div class="logo-btn" onclick="resetToHome()">
            <div style="background: var(--blue); width: 32px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-weight: 800;">F</div>
            <span style="font-weight: 800; font-size: 18px;">Dashboard</span>
        </div>
        
        <div class="nav-section" onclick="toggleAccordion('group-visao', this)">Vis√£o</div>
        <div id="group-visao" class="nav-group">
            <div class="nav-item" id="nav-dashboard" onclick="showView('dashboard')">üìä Dashboard</div>
            <div class="nav-item" id="nav-detalhes" onclick="showView('detalhes')">üîç Listagem Inteligente</div>
            <div class="nav-item" id="nav-projecoes" onclick="showView('projecoes')">üîÆ Proje√ß√µes</div>
        </div>

        <div class="nav-section" onclick="toggleAccordion('group-cats', this)">Categorias</div>
        <div id="group-cats" class="nav-group">
            <div id="catMenu"></div>
        </div>

        <div style="flex:1"></div>
        <select id="monthFilter" class="form-control" onchange="updateView()">
            <option value="all">Ano Completo</option>
            <option value="0">Janeiro</option>
            <option value="1">Fevereiro</option>
            <option value="2">Mar√ßo</option>
        </select>
    </aside>

    <div class="main-container">
        <div class="topbar">
            <div id="viewTitle" style="font-weight: 800; font-size: 22px;">Home</div>
            <div style="display:flex; gap: 12px;">
                <button class="btn btn-ghost" onclick="location.reload()" title="Atualizar P√°gina">üîÑ</button>
                <button class="btn btn-ghost" onclick="toggleHide()">üëÅÔ∏è</button>
                <button class="btn btn-ghost" onclick="toggleTheme()">üåì</button>
                <button class="btn btn-primary" onclick="openModal()">Ôºã Adicionar</button>
            </div>
        </div>
        <div class="content-area" id="pageContent"></div>
    </div>
</div>

<div class="modal" id="modal">
    <div class="modal-content">
        <h3 id="modalTitle">Novo Registro</h3>
        <input type="hidden" id="editId">
        <div class="form-group">
            <label>Tipo</label>
            <select class="form-control" id="fType" onchange="updateCatOptions()">
                <option value="despesa">Despesa</option>
                <option value="receita">Receita</option>
            </select>
        </div>
        <div class="form-group"><label>Descri√ß√£o</label><input type="text" id="fName" class="form-control"></div>
        <div class="form-group"><label>Valor (R$)</label><input type="number" id="fValue" class="form-control" step="0.01"></div>
        <div class="form-group"><label>Categoria</label><select id="fCat" class="form-control"></select></div>
        
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px">
            <div class="form-group"><label>M√™s</label><select id="fMonth" class="form-control"></select></div>
            <div class="form-group"><label>Ano</label><input type="number" id="fYear" class="form-control" value="2026"></div>
        </div>

        <div style="display:flex; gap: 12px; margin-top: 20px;">
            <button class="btn btn-ghost" style="flex:1" onclick="closeModal()">Sair</button>
            <button class="btn btn-primary" style="flex:1" onclick="saveData()">Salvar</button>
        </div>
    </div>
</div>

<script>
    const SESSION_DURATION = 3600 * 1000;

    function handleManualLogin() {
        if(document.getElementById('passInput').value === '130994') {
            localStorage.setItem('lastLoginTime', new Date().getTime());
            unlockDashboard();
        } else alert("Senha incorreta");
    }

    function unlockDashboard() {
        document.getElementById('loginOverlay').style.display = 'none';
        document.getElementById('mainLayout').style.display = 'flex';
        init();
    }

    function toggleAccordion(groupId, header) {
        const group = document.getElementById(groupId);
        group.classList.toggle('collapsed');
        header.classList.toggle('collapsed');
    }

    let GASTOS = JSON.parse(localStorage.getItem('fin_v_final')) || [];
    const CATS_MAP = { despesa: ['Casa', 'Carro', 'Yuri', 'Imposto', 'Investimento'], receita: ['Sal√°rio', 'Freela', 'Proventos'] };
    const MONTHS = ['Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
    let state = { view: 'dashboard', catFilter: 'all', month: 'all', hidden: false, searchQuery: '' };

    function init() { renderCatMenu(); populateDateSelect(); showView('dashboard'); }

    function resetToHome() { state.catFilter = 'all'; state.month = 'all'; document.getElementById('monthFilter').value = 'all'; showView('dashboard'); }

    function showView(v) {
        state.view = v;
        document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
        if(document.getElementById('nav-' + v)) document.getElementById('nav-' + v).classList.add('active');
        document.getElementById('viewTitle').textContent = v.toUpperCase();
        render();
    }

    function setCatFilter(c) { state.catFilter = c; state.view = 'dashboard'; render(); }

    function renderCatMenu() {
        let html = `<div class="nav-item" onclick="setCatFilter('all')">üìë Todas as Categorias</div>`;
        [...CATS_MAP.receita, ...CATS_MAP.despesa].forEach(c => {
            html += `<div class="nav-item" onclick="setCatFilter('${c}')">‚ó¶ ${c}</div>`;
        });
        document.getElementById('catMenu').innerHTML = html;
    }

    function updateView() { state.month = document.getElementById('monthFilter').value; render(); }
    function fmt(v) { return state.hidden ? 'R$ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢' : new Intl.NumberFormat('pt-BR',{style:'currency',currency:'BRL'}).format(v); }

    function render() {
        const content = document.getElementById('pageContent');
        const data = GASTOS.filter(i => {
            const m = state.month === 'all' || i.month == state.month;
            const c = state.catFilter === 'all' || i.cat === state.catFilter;
            return m && c;
        });
        if(state.view === 'dashboard') content.innerHTML = renderDashboard(data);
        if(state.view === 'detalhes') renderListagemView(content);
        if(state.view === 'projecoes') content.innerHTML = renderProjecoes();
    }

    function renderDashboard(data) {
        const rec = data.filter(i=>i.type==='receita').reduce((s,i)=>s+i.val,0);
        const desp = data.filter(i=>i.type==='despesa').reduce((s,i)=>s+i.val,0);
        return `
            <div style="display:grid; grid-template-columns: repeat(3, 1fr); gap: 20px;">
                <div class="card"><small>RECEITAS</small><h2 style="color:var(--green)">${fmt(rec)}</h2></div>
                <div class="card"><small>DESPESAS</small><h2 style="color:var(--red)">${fmt(desp)}</h2></div>
                <div class="card"><small>SALDO</small><h2 style="color:var(--blue)">${fmt(rec-desp)}</h2></div>
            </div>
            <div class="card"><h3>Resumo por Categoria</h3>${renderCategoriaSummary(data)}</div>
        `;
    }

    function renderCategoriaSummary(data) {
        const summary = {};
        data.forEach(i => summary[i.cat] = (summary[i.cat] || 0) + i.val);
        return Object.entries(summary).map(([cat, val]) => `<div style="display:flex; justify-content:space-between; padding: 10px 0; border-bottom: 1px solid var(--border);"><span>${cat}</span><b>${fmt(val)}</b></div>`).join('') || 'Sem dados.';
    }

    function renderListagemView(container) {
        container.innerHTML = `
            <input type="text" id="searchInput" class="form-control" placeholder="Busca inteligente..." oninput="state.searchQuery=this.value; updateListTable()" value="${state.searchQuery}">
            <div class="card">
                <table style="width:100%; border-collapse:collapse">
                    <thead><tr style="border-bottom:2px solid var(--border)"><th>Data</th><th>Descri√ß√£o</th><th>Categoria</th><th>Valor</th><th>A√ß√£o</th></tr></thead>
                    <tbody id="listTableBody"></tbody>
                </table>
            </div>
        `;
        updateListTable();
    }

    function updateListTable() {
        const tbody = document.getElementById('listTableBody');
        if(!tbody) return;
        let filtered = GASTOS.filter(i => {
            const q = state.searchQuery.toLowerCase();
            return i.name.toLowerCase().includes(q) || i.cat.toLowerCase().includes(q);
        });
        tbody.innerHTML = filtered.map(i => `
            <tr style="border-bottom:1px solid var(--border)">
                <td style="padding:12px">${MONTHS[i.month]} ${i.year}</td>
                <td style="padding:12px; font-weight:700">${i.name}</td>
                <td style="padding:12px"><span class="tag tag-${i.type}">${i.cat}</span></td>
                <td style="padding:12px; font-weight:800; color:${i.type==='receita'?'var(--green)':'var(--red)'}">${fmt(i.val)}</td>
                <td style="padding:12px"><button onclick="deleteItem(${i.id})" class="btn-ghost">üóëÔ∏è</button></td>
            </tr>
        `).join('') || '<tr><td colspan="5" style="padding:20px; text-align:center">Nenhum dado.</td></tr>';
    }

    function renderProjecoes() {
        setTimeout(() => buildProjectionChart(), 100);
        return `<div class="card"><h3>Proje√ß√£o 2026</h3><div style="height:400px"><canvas id="canvasProj"></canvas></div></div>`;
    }

    function buildProjectionChart() {
        const ctx = document.getElementById('canvasProj');
        if(!ctx) return;
        const lastMonth = GASTOS.length > 0 ? Math.max(...GASTOS.map(i => i.month)) : 0;
        const avgRec = GASTOS.filter(i=>i.type==='receita').reduce((s,i)=>s+i.val,0) / (lastMonth + 1) || 0;
        const avgDesp = GASTOS.filter(i=>i.type==='despesa').reduce((s,i)=>s+i.val,0) / (lastMonth + 1) || 0;
        const dRec = [], dDesp = [];
        MONTHS.forEach((_, i) => {
            if(i <= lastMonth) {
                dRec.push(GASTOS.filter(it=>it.month===i && it.type==='receita').reduce((s,it)=>s+it.val,0));
                dDesp.push(GASTOS.filter(it=>it.month===i && it.type==='despesa').reduce((s,it)=>s+it.val,0));
            } else { dRec.push(avgRec); dDesp.push(avgDesp); }
        });
        new Chart(ctx, { type: 'line', data: { labels: MONTHS, datasets: [{ label: 'Receitas', data: dRec, borderColor: '#28cd41' }, { label: 'Despesas', data: dDesp, borderColor: '#ff3b30' }] }, options: { responsive: true, maintainAspectRatio: false } });
    }

    function openModal() { document.getElementById('modal').style.display='flex'; updateCatOptions(); }
    function closeModal() { document.getElementById('modal').style.display='none'; }
    function populateDateSelect() {
        const s = document.getElementById('fMonth');
        if(s) MONTHS.forEach((m, i) => s.innerHTML += `<option value="${i}">${m}</option>`);
    }
    function updateCatOptions() {
        const t = document.getElementById('fType').value;
        document.getElementById('fCat').innerHTML = CATS_MAP[t].map(c => `<option value="${c}">${c}</option>`).join('');
    }
    function saveData() {
        const d = { id: Date.now(), type: document.getElementById('fType').value, name: document.getElementById('fName').value, val: parseFloat(document.getElementById('fValue').value), cat: document.getElementById('fCat').value, month: parseInt(document.getElementById('fMonth').value), year: parseInt(document.getElementById('fYear').value) };
        GASTOS.push(d); localStorage.setItem('fin_v_final', JSON.stringify(GASTOS));
        closeModal(); render();
    }
    function deleteItem(id) { if(confirm("Excluir?")) { GASTOS = GASTOS.filter(i=>i.id!==id); localStorage.setItem('fin_v_final', JSON.stringify(GASTOS)); render(); } }
    function toggleTheme() { document.body.dataset.theme = document.body.dataset.theme==='dark'?'light':'dark'; }
    function toggleHide() { state.hidden = !state.hidden; render(); }

    window.onload = () => {
        const lastLogin = localStorage.getItem('lastLoginTime');
        if (lastLogin && (new Date().getTime() - lastLogin < SESSION_DURATION)) unlockDashboard();
    };
</script>
</body>
</html>